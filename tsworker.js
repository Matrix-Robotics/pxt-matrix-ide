const worker=(t,e,n)=>class extends t{constructor(t,n){super(t,n),this.weightCache={},this.service=e.createLanguageService(this)}async getCompletionsAtPosition(t,n){const o=await super.getCompletionsAtPosition(t,n);if(!o)return o;o.entries=o.entries.filter((t=>!t.name.startsWith("_")));const i=this.service.getProgram(),r=i.getSourceFile(t),s=r.getFullText();let c=n;for(;c>0&&e.isIdentifierPart(s.charCodeAt(n),e.ScriptTarget.ES5);)c--;if("."!==s.charAt(c)&&(c=-1),c>0){const t=findInnerMostNodeAtPosition(r,c-1,e),n=i.getTypeChecker(),s=n.getTypeAtLocation(t),a=(null==s?void 0:s.symbol)||n.getSymbolAtLocation(t);if(a){const t=n.getFullyQualifiedName(a);if(!this.weightCache[t]){this.weightCache[t]={};const n=[];a.members&&n.push(a.members),a.exports&&n.push(a.exports);for(const o of n)o.forEach((n=>{const o=parseCommentString(getComments(n,e));o.weight?this.weightCache[t][n.name]=weightToSortText(o.weight):this.weightCache[t][n.name]=weightToSortText(0)}))}for(const e of o.entries){const n=this.weightCache[t][e.name]||weightToSortText(0);e.sortText=n+e.name}}}return o}};function findInnerMostNodeAtPosition(t,e,n){for(let o of t.getChildren()){if(o.kind>=n.SyntaxKind.FirstPunctuation&&o.kind<=n.SyntaxKind.LastPunctuation)continue;let t=o.getStart(),i=o.getEnd();if(t<=e&&e<i)return findInnerMostNodeAtPosition(o,e,n)}return t&&t.kind===n.SyntaxKind.SourceFile?null:t}function getComments(t,e){return t.getDeclarations()?t.getDeclarations().map((t=>{const n=t.getSourceFile();if(!n)return"";const o=e.getLeadingCommentRangesOfNode(t,n);if(!o)return"";return o.map((t=>n.text.slice(t.pos,t.end))).join("\n")})).join("\n"):""}function parseCommentString(t){const e={};return t=t.replace(/\/\/%[ \t]*([\w\.-]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/g,((t,n,o,i,r,s,c)=>{const a=r?JSON.parse(r):o?r||s||c:"true";return e[n]=a,""})),e}function weightToSortText(t){let e;e="string"==typeof t?parseInt(t):t,e=9999-e;let n=e+"";for(;n.length<4;)n="0"+n;return n}self.customTSWorkerFactory=worker;